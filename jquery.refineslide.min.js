/*
 * jQuery RefineSlide plugin v0.1
 * http://github.com/alexdunphy/refineslide
 * Requires: jQuery v1.7+
 * Copyright 2012, Alex Dunphy
 * MIT License (http://www.opensource.org/licenses/mit-license.php)
 *
 * Includes: jQuery imagesLoaded plugin v1.2.1
 * http://github.com/desandro/imagesloaded
 * MIT License. by Paul Irish et al.
 */
;(function(f,e,a,h){var g={transition:"cubeV",fallback3d:"sliceV",controls:"thumbs",thumbMargin:3,autoPlay:false,delay:5000,transitionDuration:800,startSlide:0,keyNav:true,captionWidth:50,arrowTemplate:'<div class="rs-arrows"><a href="#" class="rs-prev"></a><a href="#" class="rs-next"></a></div>',onInit:function(){},onChange:function(){},afterChange:function(){}};function b(j,i){this.$slider=f(j);this.settings=f.extend({},g,i);this.$slides=this.$slider.find("> li");this.totalSlides=this.$slides.length;this.cssTransitions=c.cssTransitions();this.cssTransforms3d=c.cssTransforms3d();this.currentPlace=this.settings.startSlide;this.$currentSlide=f(this.$slides[this.currentPlace]);this.inProgress=false;this.$sliderWrap=this.$slider.wrap('<div class="rs-wrap" />').parent();this.$sliderBG=this.$slider.wrap('<div class="rs-slide-bg" />').parent();this.settings.slider=this;this.init()}b.prototype={init:function(){var m=this;this.settings.onInit();this.captions();if(this.settings.controls==="arrows"){this.setArrows()}if(this.settings.keyNav){this.setKeys()}for(var k=0;k<this.totalSlides;k++){f(this.$slides[k]).attr("class","rs-slide-"+k)}if(this.settings.autoPlay){this.setAutoPlay();this.$slider.on("mouseenter",function(){clearTimeout(m.cycling)});this.$slider.on("mouseleave",function(){m.setAutoPlay()})}var j=f(this.$slides).find("img:eq(0)").addClass("rs-slide-image"),l=[];f(j).imagesLoaded(function(){for(var n=0;n<m.totalSlides;n++){l.push(f(j[n]).clone().css({position:"absolute",visibility:"hidden",display:"block"}).appendTo(m.$slider))}setTimeout(function(){m.setup(l)},0)})},setup:function(l){var n=this,m=parseInt(this.$sliderBG.css("padding-left").replace("px",""))+parseInt(this.$sliderBG.css("padding-right").replace("px","")),k=[];var j=l.length;while(j--){k.push(f(l[j]).width());if(n.settings.controls!=="thumbs"){f(l[j]).remove()}}this.$sliderWrap.css("width",Math.floor.apply(Math,k)+m);if(this.settings.controls==="thumbs"){this.setThumbs(l)}this.$currentSlide.css({opacity:1,"z-index":2});this.$sliderBG.prefixes({transform:"translateZ(0)"})},setArrows:function(){var i=this;this.$sliderWrap.append(this.settings.arrowTemplate);f(".rs-next",this.$sliderWrap).on("click",function(j){j.preventDefault();i.next()});f(".rs-prev",this.$sliderWrap).on("click",function(j){j.preventDefault();i.prev()})},next:function(){if(this.currentPlace===this.totalSlides-1){this.transition(0)}else{this.transition(this.currentPlace+1)}},prev:function(){if(this.currentPlace==0){this.transition(this.totalSlides-1)}else{this.transition(this.currentPlace-1)}},setKeys:function(){var i=this;f(a).on("keydown",function(j){if(j.keyCode===39){i.next()}else{if(j.keyCode===37){i.prev()}}})},setAutoPlay:function(){var i=this;this.cycling=setTimeout(function(){i.next()},this.settings.delay)},setThumbs:function(l){var n=this,k=(100-((this.totalSlides-1)*this.settings.thumbMargin))/this.totalSlides+"%";this.$thumbWrap=f('<div class="rs-thumb-wrap" />').appendTo(this.$sliderWrap);for(var j=0;j<this.totalSlides;j++){var m=f('<a class="rs-slide-link-'+j+'" />').css({width:k,marginLeft:this.settings.thumbMargin+"%"}).attr({href:"#"});f(l[j]).removeAttr("style").appendTo(this.$thumbWrap).wrap(m)}this.$thumbWrap.children().last().css("margin-right",-10);f(this.$thumbWrap.find("a")[this.settings.startSlide]).addClass("active");this.$thumbWrap.on("click","a",function(o){o.preventDefault();var i=parseInt(f(this).attr("class").split("-")[3]);n.transition(i)})},captions:function(){var j=this,i=this.$slides.find(".rs-caption");i.css({width:j.settings.captionWidth+"%",opacity:0});this.$currentSlide.find(".rs-caption").css({opacity:1});i.each(function(){f(this).prefixes({transition:"opacity "+j.settings.transitionDuration+"ms ease-in-out",transform:"translateZ(0)"})})},transition:function(j){if(!this.inProgress){if(j!==this.currentPlace){var i=j>this.currentPlace?true:false;this.$nextSlide=f(this.$slides[j]);this.currentPlace=j;this.settings.onChange();new d(this,this.settings.transition,i);if(this.settings.controls==="thumbs"){this.$thumbWrap.find("a").removeClass("active");f(this.$thumbWrap.find("a")[j]).addClass("active")}}}}};function d(j,k,i){this.RS=j;this.RS.inProgress=true;this.forward=i;this.transition=k;this.fallback3d=this.RS.settings.fallback3d;this.init()}d.prototype={fallback:"fade",anims:["cubeH","cubeV","fade","sliceH","sliceV","slideH","slideV","scale","blockScale","kaleidoscope","fan","blindH","blindV"],init:function(){this[this.transition]()},before:function(k){var j=this;this.RS.$currentSlide.css("z-index",2);this.RS.$nextSlide.css({opacity:1,"z-index":1});if(this.RS.cssTransitions){this.RS.$currentSlide.find(".rs-caption").css("opacity",0);this.RS.$nextSlide.find(".rs-caption").css("opacity",1)}else{this.RS.$currentSlide.find(".rs-caption").animate({opacity:0},j.RS.settings.transitionDuration);this.RS.$nextSlide.find(".rs-caption").animate({opacity:1},j.RS.settings.transitionDuration)}if(typeof this.setup==="function"){var i=this.setup();setTimeout(function(){k(i)},0)}else{this.execute()}if(this.RS.cssTransitions){f(this.listenTo).on("webkitTransitionEnd transitionend oTransitionEnd msTransitionend MSTransitionEnd",function(){j.after()})}},after:function(){this.RS.$slider.removeAttr("style");this.RS.$currentSlide.removeAttr("style").css("opacity",0);this.RS.$nextSlide.removeAttr("style").css({"z-index":2,opacity:1});if(typeof this.reset==="function"){this.reset()}f(this.listenTo).off("webkitTransitionEnd transitionend oTransitionEnd msTransitionend MSTransitionEnd");if(this.RS.settings.autoPlay){clearTimeout(this.RS.cycling);this.RS.setAutoPlay()}this.RS.$currentSlide=this.RS.$nextSlide;this.RS.inProgress=false;this.RS.settings.afterChange()},fade:function(){var i=this;if(this.RS.cssTransitions){this.setup=function(){i.listenTo=i.RS.$currentSlide;i.RS.$currentSlide.prefixes({transition:"opacity "+i.RS.settings.transitionDuration+"ms ease-in-out"})};this.execute=function(){i.RS.$currentSlide.css({opacity:0})}}else{this.execute=function(){i.RS.$currentSlide.animate({opacity:0},i.RS.settings.transitionDuration,function(){i.after()})}}this.before(function(){i.execute()})},cube:function(p,j,i,n,m,l,k){if(!this.RS.cssTransitions||!this.RS.cssTransforms3d){return this[this["fallback3d"]]()}var o=this;this.setup=function(){o.listenTo=o.RS.$slider;this.RS.$sliderBG.prefixes({perspective:1000});var q={transform:"translateZ("+p+"px)","backface-visibility":"hidden"};o.RS.$currentSlide.prefixes(q);o.RS.$nextSlide.prefixes(q);o.RS.$slider.prefixes({transition:"none","transform-style":"preserve-3d",transform:"translateZ(-"+p+"px)"});o.RS.$nextSlide.css({opacity:1}).prefixes({transform:"translateZ(0px) translateY("+i+"px) translateX("+j+"px) rotateY("+m+"deg) rotateX("+n+"deg)"})};this.execute=function(){var q=[];for(var r=0;r<c.browserVendors.length;r++){q[c.browserVendors[r]+"transition"]=c.browserVendors[r]+"transform "+o.RS.settings.transitionDuration+"ms ease-in-out"}o.RS.$slider.prefixes(q);o.RS.$slider.prefixes({transform:"translateZ(-"+p+"px) rotateX("+l+"deg) rotateY("+k+"deg)"})};this.before(function(){o.execute()})},cubeH:function(){var i=f(this.RS.$slides).width()/2;if(this.forward){this.cube(i,i,0,0,90,0,-90)}else{this.cube(i,-i,0,0,-90,0,90)}},cubeV:function(){var i=f(this.RS.$slides).height()/2;if(this.forward){this.cube(i,0,-i,90,0,-90,0)}else{this.cube(i,0,i,-90,0,90,0)}},grid:function(m,l,k,j,i,n,p){if(!this.RS.cssTransitions){return this[this["fallback"]]()}var o=this;this.setup=function(){var w=(o.RS.settings.transitionDuration)/(m+l);function v(L,S,P,M,K,Q,R,O,J){var N=(O+J)*w;console.log((m+l)*w);return f('<div class="rs-gridlet" />').css({width:L,height:S,top:P,left:M,"background-image":"url("+K+")","background-position":"-"+M+"px -"+P+"px","background-size":Q+"px "+R+"px"}).prefixes({transition:"all "+o.RS.settings.transitionDuration+"ms ease-in-out "+N+"ms",transform:"none"})}o.$img=o.RS.$currentSlide.find("img.rs-slide-image");o.$grid=f("<div />").addClass("rs-grid");o.RS.$currentSlide.prepend(o.$grid);var x=o.$img.width(),G=o.$img.height(),r=o.$img.attr("src"),I=Math.floor(x/m),t=Math.floor(G/l),B=x-(m*I),y=Math.ceil(B/m),C=G-(l*t),s=Math.ceil(C/l),H=0;j=j==="auto"?x:j;j=j==="min-auto"?-x:j;i=i==="auto"?G:i;i=i==="min-auto"?-G:i;for(var F=0;F<m;F++){var u=0,A=I;if(B>0){var z=B>=y?y:B;A+=z;B-=z}for(var E=0;E<l;E++){var D=t,q=C;if(q>0){z=q>=s?s:C;D+=z;q-=z}o.$grid.append(v(A,D,u,H,r,x,G,F,E));u+=D}H+=A}o.listenTo=o.$grid.children().last();o.$grid.show();o.$img.css("opacity",0);o.$grid.children().first().addClass("rs-top-left");o.$grid.children().last().addClass("rs-bottom-right");o.$grid.children().eq(l-1).addClass("rs-bottom-left");o.$grid.children().eq(-l).addClass("rs-top-right")};this.execute=function(){o.$grid.children().css("opacity",p).prefixes({transform:"rotate("+k+"deg) translateX("+j+"px) translateY("+i+"px) scale("+n+")"})};this.before(function(){o.execute()});this.reset=function(){o.$img.css("opacity",1);o.$grid.remove()}},sliceH:function(){this.grid(1,8,0,"min-auto",0,1,0)},sliceV:function(){this.grid(10,1,0,0,"auto",1,0)},slideV:function(){this.grid(1,1,0,0,"auto",1,1)},slideH:function(){this.grid(1,1,0,"min-auto",0,1,1)},scale:function(){this.grid(1,1,0,0,0,1.5,0)},blockScale:function(){this.grid(8,6,0,0,0,0.6,0)},kaleidoscope:function(){this.grid(10,8,0,0,0,1,0)},fan:function(){this.grid(1,10,45,100,0,1,0)},blindV:function(){this.grid(1,8,0,0,0,0.7,0)},blindH:function(){this.grid(10,1,0,0,0,0.7,0)},random:function(){this[this.anims[Math.floor(Math.random()*this.anims.length)]]()}};var c={browserVendors:["","-webkit-","-moz-","-ms-","-o-","-khtml-"],domPrefixes:["","Webkit","Moz","ms","O","Khtml"],testDom:function(k){var j=this.domPrefixes.length;while(j--){if(a.body.style[this.domPrefixes[j]+k]!==h){return true}}return false},cssTransitions:function(){if(e.Modernizr&&Modernizr.csstransitions!==h){return Modernizr.csstransitions}return this.testDom("Transition")},cssTransforms3d:function(){if(e.Modernizr&&Modernizr.csstransforms3d!==h){return Modernizr.csstransforms3d}if(a.body.style.perspectiveProperty!==h){return true}return this.testDom("Perspective")}};f.fn.prefixes=function(l){var j=[];for(var m in l){if(l.hasOwnProperty(m)){var k=c.browserVendors.length;while(k--){j[c.browserVendors[k]+m]=l[m]}}}this.css(j);return this};f.fn.imagesLoaded=function(r){var o=this,s=f.Deferred(),j=o.find("img").add(o.filter("img")),n=j.length,l="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",k=[],q=[],m=[];function p(){var t=f(q),u=f(m);if(m.length){s.reject(j,t,u)}else{s.resolve(j)}r.call(o,j,t,u)}function i(t){if(t.target.src===l||f.inArray(this,k)!==-1){return}k.push(this);if(t.type==="error"){m.push(this)}else{q.push(this)}s.notify(j.length,k.length,q.length,m.length);if(--n<=0){setTimeout(p);j.unbind(".imagesLoaded",i)}}if(!n){p()}j.bind("load.imagesLoaded error.imagesLoaded",i).each(function(){var t=this.src;this.src=l;this.src=t});return s.promise(o)};f.fn.refineSlide=function(i){return this.each(function(){if(!f.data(this,"refineSlide")){f.data(this,"refineSlide",new b(this,i))}})}})(jQuery,window,document);